<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="css/airvis.css">
    <title></title>

<!-- 
  <script type="text/javascript">
    var require = { baseUrl: "http://airvis03.ragneta.com/js" };
  </script>
-->

    <script data-main="js/init" src="js/lib/require.js"></script>

    <script type="text/javascript">

      window.airvisPageLoadedCallback = function(self) {
        console.log("callback");
        self.on("domInit",function() {
          $("a.test1").click(function() {
            self.setOption("contestId","cnts-130529-2717963794");
            self.setOption("raceId","r-f9ee78a7-6e38-4e49-888f-8fd6452cb864");
            self.rebuild();
          });
          $("a.test2").click(function() {
            self.setOption("contestId","cnts-130529-2717963794");
            self.setOption("raceId","r-6a31d091-c481-491d-a84b-be5749b7411c");
            self.rebuild();
          });
        });
        self.on("loadingError",function() {
          console.log("LOADING ERROR");
        });
        self.on("loaded",function() {
          console.log("LOADING SUCCESS");
        });

        var getTimeStr = function(h,m,s) {
          h = Math.abs(h);
          m = Math.abs(m);
          s = Math.abs(s);
          return (h<10?"0":"") + h + ":" + (m<10?"0":"") + m + ":" + (s<10?"0":"") + s;
        }

        var setTime = function() {
          var d = Math.floor((self.raceKey()-new Date().getTime())/1000);
          document.getElementById("time").innerHTML = (d<0?"-":"") + getTimeStr(Math.floor(d/3600),Math.floor(d%3600/60),d%60);
          setTimeout(setTime,1000);
        }
        setTime();
      }

    </script>

  </head>
  <body>
    <div role="main" class="airvis-container">
      <!-- ko widget: { data: page, imgRootUrl: "/img/", contestId: "cnts-130529-2717963794", raceId: "r-f9ee78a7-6e38-4e49-888f-8fd6452cb864", width: "100%", height: "380px", apiDomain: "http://api.airtribune.com", apiVersion: "v0.2", mapWidget: "2d", mapOptions: {panControl:false,streetViewControl:false,mode:"simple",zoomControl:true,minZoom:3,maxZoom:19,scaleControl:true,scaleControlOptions:{position:9},scrollwheel:false,activateScrollWheelOnClick:true}, titleUrl: "http://lala.com", isOnline: false, debug: true, callback: window.airvisPageLoadedCallback } --><!-- /ko -->
      <br><br>
      <a href="#" class="test1">Test1</a>
      <a href="#" class="test2">Test2</a>
      <div id="time"></div>
    </div>
  </body>
</html>
